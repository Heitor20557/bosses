<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Floral Fury: Extreme Island</title>
    <style>
        body { margin: 0; background: #0a0a0a; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; font-family: 'Arial Black', sans-serif; }
        canvas { background: #1e272e; border: 4px solid #3d3d3d; box-shadow: 0 0 100px #000; cursor: crosshair; }
        #hud { position: absolute; top: 20px; left: 20px; color: #ff3e3e; font-size: 24px; text-shadow: 2px 2px #000; display: none; pointer-events: none; z-index: 10; }
    </style>
</head>
<body>

<div id="hud">HP: <span id="hp-val">3</span> | STATUS: <span id="boss-lvl">---</span></div>
<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = 800; canvas.height = 450;

let gameState = 'MENU';
let bossesUnlocked = 1; // Sistema de progressÃ£o
const keys = {};
let shake = 0; // Para tremer a tela

// --- SISTEMA DE CLIQUE E MAPA ---
window.addEventListener('mousedown', e => {
    if (gameState === 'HUB') {
        const rect = canvas.getBoundingClientRect();
        const mx = e.clientX - rect.left; const my = e.clientY - rect.top;
        if (mx > 100 && mx < 220 && my > 180 && my < 300) startBoss(1);
        if (mx > 340 && mx < 460 && my > 80 && my < 200 && bossesUnlocked >= 2) startBoss(2);
        if (mx > 580 && mx < 700 && my > 180 && my < 300 && bossesUnlocked >= 3) startBoss(3);
        if (mx > 340 && mx < 460 && my > 250 && my < 370 && bossesUnlocked >= 4) startBoss(4);
    }
});

window.addEventListener('keydown', e => { keys[e.code] = true; if (gameState === 'MENU' && e.code === 'Enter') gameState = 'HUB'; else if ((gameState === 'GAMEOVER' || gameState === 'WIN') && e.code === 'Enter') gameState = 'HUB'; });
window.addEventListener('keyup', e => keys[e.code] = false);

let player, boss1, boss2, boss3, boss4, pBullets, bBullets, platforms;

function startBoss(id) {
    player = { x: 100, y: 300, w: 35, h: 50, vx: 0, vy: 0, speed: 5, jump: -14, grounded: false, hp: 3, shootTimer: 0, invul: 0, dashTimer: 0, isDashing: false, gravity: 0.7 };
    pBullets = []; bBullets = [];
    platforms = [{x: 80, y: 310, w: 100, h: 15}, {x: 230, y: 230, w: 100, h: 15}, {x: 380, y: 310, w: 100, h: 15}];
    
    // Reset de todos os bosses
    boss1 = { active: false }; boss2 = { active: false }; boss3 = { active: false }; boss4 = { active: false };

    if (id === 1) {
        boss1 = { x: 550, y: 70, w: 180, h: 160, hp: 100, phase: 1, attackTimer: 0, active: true, isDying: false };
        document.getElementById('boss-lvl').innerText = "FLOR FASE 1";
    } else if (id === 2) {
        boss2 = { x: 400, y: 50, w: 160, h: 120, hp: 150, phase: 1, attackTimer: 0, active: true, vx: 4, vy: 2, isDying: false, rotation: 0 };
        document.getElementById('boss-lvl').innerText = "UMBRELLA FASE 1";
    } else if (id === 3) {
        boss3 = { x: 550, y: 150, w: 180, h: 260, hp: 250, phase: 1, attackTimer: 0, active: true, isDying: false };
        document.getElementById('boss-lvl').innerText = "GOLEM FASE 1";
    } else if (id === 4) {
        boss4 = { x: 600, y: 100, w: 150, h: 150, hp: 400, phase: 1, attackTimer: 0, active: true, isDying: false, targetY: 100 };
        document.getElementById('boss-lvl').innerText = "VOID FASE 1";
    }
    
    gameState = 'PLAYING';
    document.getElementById('hud').style.display = 'block';
    updateHUD();
}

function updateHUD() { document.getElementById('hp-val').innerText = player.hp; }

function checkRectCollision(a, b) {
    let bw = b.w || b.size || 10; let bh = b.h || b.size || 10;
    return a.x < b.x + bw && a.x + (a.w || 35) > b.x && a.y < b.y + bh && a.y + (a.h || 50) > b.y;
}

function update() {
    if (gameState === 'HUB') {
        if (keys['ArrowLeft']) player.x -= 5; if (keys['ArrowRight']) player.x += 5;
        if (keys['ArrowUp']) player.y -= 5; if (keys['ArrowDown']) player.y += 5;
        return;
    }
    if (gameState !== 'PLAYING') return;

    // --- PLAYER (LÃ“GICA ORIGINAL PRESERVADA) ---
    if (keys['KeyC'] && player.dashTimer <= 0) { player.isDashing = true; player.dashTimer = 40; player.invul = 15; }
    if (player.isDashing) { player.vx = 15; if (player.dashTimer < 25) player.isDashing = false; } 
    else { player.vx = keys['ArrowLeft'] ? -player.speed : (keys['ArrowRight'] ? player.speed : 0); }
    if (player.dashTimer > 0) player.dashTimer--;
    if ((keys['Space'] || keys['KeyZ']) && player.grounded) { player.vy = player.jump; player.grounded = false; }
    player.vy += player.gravity; player.x += player.vx; player.y += player.vy;

    if (player.y + player.h > canvas.height - 40) { player.y = canvas.height - 40 - player.h; player.vy = 0; player.grounded = true; }
    platforms.forEach(p => { if (player.vy > 0 && checkRectCollision(player, p) && player.y + player.h < p.y + 15) { player.y = p.y - player.h; player.vy = 0; player.grounded = true; } });

    if (keys['KeyX'] && player.shootTimer <= 0) { pBullets.push({x: player.x + player.w, y: player.y + 15, size: 8}); player.shootTimer = 10; }
    if (player.shootTimer > 0) player.shootTimer--;

    pBullets.forEach((b, i) => {
        b.x += 12;
        if (boss1.active && !boss1.isDying && checkRectCollision(b, boss1)) { boss1.hp -= 1.2; pBullets.splice(i, 1); }
        else if (boss2.active && !boss2.isDying && checkRectCollision(b, boss2)) { boss2.hp -= 1.5; pBullets.splice(i, 1); }
        else if (boss3.active && !boss3.isDying && checkRectCollision(b, boss3)) { boss3.hp -= 1.8; pBullets.splice(i, 1); }
        else if (boss4.active && !boss4.isDying && checkRectCollision(b, boss4)) { boss4.hp -= 2; pBullets.splice(i, 1); }
        else if (b.x > 800) pBullets.splice(i, 1);
    });

    // --- BOSS 1: FLOR ---
    if (boss1.active) {
        if (boss1.isDying) { boss1.y += 5; if (boss1.y > 500) { bossesUnlocked = Math.max(bossesUnlocked, 2); gameState = 'WIN'; } }
        else {
            boss1.attackTimer++;
            if (boss1.hp < 66 && boss1.phase === 1) { boss1.phase = 2; document.getElementById('boss-lvl').innerText = "FLOR FASE 2"; }
            if (boss1.hp < 33 && boss1.phase === 2) { boss1.phase = 3; document.getElementById('boss-lvl').innerText = "FLOR FASE FINAL"; }
            if (boss1.attackTimer % 80 === 0) bBullets.push({x: boss1.x, y: 150, vx: -7, vy: (Math.random()-0.5)*4, size: 20, color: 'orange'});
            if (boss1.hp <= 0) boss1.isDying = true;
        }
    }

    // --- BOSS 2: UMBRELLA ---
    else if (boss2.active) {
        if (boss2.isDying) { boss2.rotation += 0.5; boss2.y -= 5; if (boss2.y < -200) { bossesUnlocked = Math.max(bossesUnlocked, 3); gameState = 'WIN'; } }
        else {
            boss2.attackTimer++;
            if (boss2.hp < 100 && boss2.phase === 1) { boss2.phase = 2; document.getElementById('boss-lvl').innerText = "UMBRELLA FASE 2"; }
            if (boss2.hp < 50 && boss2.phase === 2) { boss2.phase = 3; document.getElementById('boss-lvl').innerText = "UMBRELLA FASE FINAL"; }
            boss2.x += boss2.vx; if (boss2.x > 600 || boss2.x < 100) boss2.vx *= -1;
            if (boss2.attackTimer % 60 === 0) bBullets.push({x: boss2.x + 80, y: boss2.y + 100, vx: 0, vy: 6, size: 15, color: '#3498db'});
            if (boss2.hp <= 0) boss2.isDying = true;
        }
    }

    // --- BOSS 3: GOLEM (MUITO MAIS DIFÃCIL) ---
    else if (boss3.active) {
        if (boss3.isDying) { shake = 20; boss3.y += 2; if (boss3.y > 500) { bossesUnlocked = Math.max(bossesUnlocked, 4); gameState = 'WIN'; } }
        else {
            boss3.attackTimer++;
            if (boss3.hp < 170 && boss3.phase === 1) { boss3.phase = 2; document.getElementById('boss-lvl').innerText = "GOLEM FASE 2"; }
            if (boss3.hp < 80 && boss3.phase === 2) { boss3.phase = 3; document.getElementById('boss-lvl').innerText = "GOLEM FASE FINAL"; }
            
            if (boss3.attackTimer % 120 === 0) { // Terremoto
                shake = 15;
                bBullets.push({x: 0, y: 400, vx: 10, vy: 0, size: 50, color: '#57606f'});
                bBullets.push({x: 800, y: 400, vx: -10, vy: 0, size: 50, color: '#57606f'});
            }
            if (boss3.phase >= 2 && boss3.attackTimer % 40 === 0) { // Chuva de pedras
                bBullets.push({x: Math.random()*800, y: -50, vx: 0, vy: 7, size: 25, color: '#2f3542'});
            }
            if (boss3.hp <= 0) boss3.isDying = true;
        }
    }

    // --- BOSS 4: VOID (QUASE IMPOSSÃVEL) ---
    else if (boss4.active) {
        if (boss4.isDying) { if (Math.random() > 0.5) shake = 30; if (boss4.hp < -100) gameState = 'WIN'; boss4.hp -= 1; }
        else {
            boss4.attackTimer++;
            if (boss4.hp < 300 && boss4.phase === 1) { boss4.phase = 2; document.getElementById('boss-lvl').innerText = "VOID FASE 2"; }
            if (boss4.hp < 150 && boss4.phase === 2) { boss4.phase = 3; document.getElementById('boss-lvl').innerText = "VOID FASE FINAL"; }

            // MecÃ¢nica: Gravidade Invertida
            if (boss4.phase === 3 && boss4.attackTimer % 300 === 0) { player.gravity *= -1; player.jump *= -1; }

            // Ataques: CÃ­rculo de Balas
            if (boss4.attackTimer % 50 === 0) {
                for(let i=0; i<8; i++) {
                    let a = (Math.PI*2/8)*i;
                    bBullets.push({x: boss4.x+75, y: boss4.y+75, vx: Math.cos(a)*6, vy: Math.sin(a)*6, size: 15, color: '#a29bfe'});
                }
            }
            // Laser Gigante
            if (boss4.attackTimer % 150 > 100) {
                ctx.fillStyle = 'rgba(255, 0, 0, 0.3)';
                ctx.fillRect(0, boss4.y + 70, 800, 20);
                if (player.y + 25 > boss4.y + 70 && player.y < boss4.y + 90) player.hp -= 0.05;
            }
            if (boss4.hp <= 0) boss4.isDying = true;
        }
    }

    // ColisÃµes de Dano
    bBullets.forEach((b, i) => {
        b.x += b.vx; b.y += b.vy;
        if (checkRectCollision(player, b) && player.invul <= 0) { player.hp--; player.invul = 60; updateHUD(); bBullets.splice(i, 1); }
        if (b.x < -100 || b.x > 900 || b.y > 500) bBullets.splice(i, 1);
    });

    if (player.invul > 0) player.invul--;
    if (player.hp <= 0) gameState = 'GAMEOVER';
    if (shake > 0) shake--;
}

function draw() {
    ctx.save();
    if (shake > 0) ctx.translate(Math.random()*shake - shake/2, Math.random()*shake - shake/2);
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    if (gameState === 'MENU') {
        ctx.fillStyle = '#0a0a0a'; ctx.fillRect(0,0,800,450);
        ctx.fillStyle = 'white'; ctx.textAlign = 'center'; ctx.font = '50px Arial Black';
        ctx.fillText('ISLAND OF FURY', 400, 200);
        ctx.font = '20px Arial'; ctx.fillText('PRESS ENTER TO START', 400, 260);
    } 
    else if (gameState === 'HUB') {
        ctx.fillStyle = '#1e272e'; ctx.fillRect(0,0,800,450);
        // Desenho do Mapa
        drawIcon(160, 240, '#ff4757', 'FLOWER', true);
        drawIcon(400, 140, '#1e90ff', 'UMBRELLA', bossesUnlocked >= 2);
        drawIcon(640, 240, '#747d8c', 'GOLEM', bossesUnlocked >= 3);
        drawIcon(400, 310, '#a29bfe', 'VOID', bossesUnlocked >= 4);

        ctx.fillStyle = 'white'; ctx.font='15px Arial'; ctx.fillText('WALK AND CLICK TO FIGHT', 400, 420);
        ctx.fillStyle = 'red'; ctx.fillRect(player.x, player.y, 20, 20);
    }
    else if (gameState === 'PLAYING') {
        // Background dinÃ¢mico
        let bg = ctx.createLinearGradient(0,0,0,450);
        bg.addColorStop(0, '#2f3542'); bg.addColorStop(1, '#000');
        ctx.fillStyle = bg; ctx.fillRect(0,0,800,450);
        
        ctx.fillStyle = '#2ed573'; ctx.fillRect(0, 410, 800, 40); // ChÃ£o
        ctx.fillStyle = '#ff6b81'; platforms.forEach(p => ctx.fillRect(p.x, p.y, p.w, p.h));

        if (boss1.active) {
            ctx.fillStyle = '#2f3542'; ctx.fillRect(boss1.x+80, 230, 20, 180);
            ctx.fillStyle = boss1.isDying ? '#57606f' : '#ffa502';
            ctx.beginPath(); ctx.arc(boss1.x+90, 150, 70, 0, Math.PI*2); ctx.fill();
        }
        if (boss2.active) {
            ctx.save(); ctx.translate(boss2.x+80, boss2.y+60); ctx.rotate(boss2.rotation);
            ctx.fillStyle = '#3742fa'; ctx.beginPath(); ctx.arc(0,0,80,Math.PI, 0); ctx.fill();
            ctx.strokeStyle='white'; ctx.lineWidth=3; ctx.stroke();
            ctx.restore();
        }
        if (boss3.active) {
            ctx.fillStyle = '#57606f'; ctx.fillRect(boss3.x, boss3.y, boss3.w, boss3.h);
            ctx.fillStyle = '#ff4757'; ctx.fillRect(boss3.x+30, boss3.y+50, 30, 10); ctx.fillRect(boss3.x+120, boss3.y+50, 30, 10);
        }
        if (boss4.active) {
            ctx.fillStyle = '#2f3542'; ctx.beginPath(); ctx.arc(boss4.x+75, boss4.y+75, 60, 0, Math.PI*2); ctx.fill();
            ctx.strokeStyle = '#a29bfe'; ctx.lineWidth = 5; ctx.stroke();
            ctx.fillStyle = '#ff4757'; ctx.beginPath(); ctx.arc(boss4.x+75, boss4.y+75, 20, 0, Math.PI*2); ctx.fill();
        }

        ctx.fillStyle = player.invul % 4 > 1 ? 'transparent' : 'white';
        ctx.fillRect(player.x, player.y, player.w, player.h);
        pBullets.forEach(b => { ctx.fillStyle = '#7bed9f'; ctx.fillRect(b.x, b.y, b.size, b.size); });
        bBullets.forEach(b => { ctx.fillStyle = b.color; ctx.fillRect(b.x, b.y, b.size, b.size); });
    }
    else {
        ctx.fillStyle = 'black'; ctx.fillRect(0,0,800,450);
        ctx.fillStyle = 'white'; ctx.textAlign='center'; ctx.font='50px Arial Black';
        ctx.fillText(gameState==='WIN'?'VICTORY!':'GAME OVER', 400, 200);
        ctx.font='20px Arial'; ctx.fillText('PRESS ENTER TO RETURN TO ISLAND', 400, 280);
    }
    ctx.restore();
    requestAnimationFrame(draw);
}

function drawIcon(x, y, color, label, unlocked) {
    ctx.fillStyle = unlocked ? color : '#2f3542';
    ctx.fillRect(x - 60, y - 60, 120, 120);
    ctx.strokeStyle = 'white'; ctx.lineWidth = 4;
    ctx.strokeRect(x - 60, y - 60, 120, 120);
    ctx.fillStyle = 'white'; ctx.font = '14px Arial Black';
    ctx.textAlign = 'center'; ctx.fillText(unlocked ? label : 'LOCKED', x, y + 80);
    if (!unlocked) { ctx.font = '30px Arial'; ctx.fillText('ðŸ”’', x, y + 10); }
}

draw();
</script>
</body>
</html>
