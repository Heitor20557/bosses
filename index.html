<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Cuphead - Fix Dano</title>
    <style>
        body { margin: 0; background: #222; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; font-family: sans-serif; }
        canvas { background: #4a7a3a; border: 4px solid #fff; }
        #hud { position: absolute; top: 10px; color: white; font-weight: bold; font-size: 24px; text-shadow: 2px 2px #000; }
    </style>
</head>
<body>
    <div id="hud">BOSS HP: <span id="bhp">100</span>%</div>
    <canvas id="game"></canvas>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
canvas.width = 800; canvas.height = 450;

const keys = {};
window.onkeydown = e => keys[e.code] = true;
window.onkeyup = e => keys[e.code] = false;

// --- CONFIGURAÇÕES DO PLAYER ---
const player = {
    x: 100, y: 300, w: 40, h: 50,
    vx: 0, vy: 0, grounded: false,
    shootTimer: 0
};

// --- CONFIGURAÇÕES DO BOSS ---
const boss = {
    x: 600, y: 100, w: 150, h: 300, // Área de colisão aumentada
    hp: 100
};

const bullets = [];

function checkCollision(r1, r2) {
    return r1.x < r2.x + r2.w &&
           r1.x + (r1.w || 10) > r2.x &&
           r1.y < r2.y + r2.h &&
           r1.y + (r1.h || 10) > r2.y;
}

function update() {
    // Movimento Player
    if (keys['ArrowLeft']) player.vx = -5;
    else if (keys['ArrowRight']) player.vx = 5;
    else player.vx = 0;

    if (keys['KeyZ'] && player.grounded) {
        player.vy = -13;
        player.grounded = false;
    }

    player.vy += 0.6; // Gravidade
    player.x += player.vx;
    player.y += player.vy;

    if (player.y + player.h > 400) {
        player.y = 400 - player.h;
        player.vy = 0;
        player.grounded = true;
    }

    // TIRO (Tecla X)
    if (keys['KeyX'] && player.shootTimer <= 0) {
        bullets.push({ x: player.x + player.w, y: player.y + 20, w: 15, h: 10 });
        player.shootTimer = 10; // Cadência de tiro
    }
    if (player.shootTimer > 0) player.shootTimer--;

    // LÓGICA DAS BALAS E DANO
    for (let i = bullets.length - 1; i >= 0; i--) {
        bullets[i].x += 10;

        // VERIFICAÇÃO DE DANO (MUITO IMPORTANTE)
        if (checkCollision(bullets[i], boss)) {
            boss.hp -= 2; // Tira 2% de vida por tiro
            document.getElementById('bhp').innerText = Math.max(0, boss.hp);
            bullets.splice(i, 1); // Remove a bala ao colidir
            continue;
        }

        // Remove bala se sair da tela
        if (bullets[i].x > canvas.width) bullets.splice(i, 1);
    }
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Chão
    ctx.fillStyle = '#222';
    ctx.fillRect(0, 400, canvas.width, 50);

    // Desenha Player
    ctx.fillStyle = 'red';
    ctx.fillRect(player.x, player.y, player.w, player.h);

    // Desenha Boss (Área de colisão visível em laranja para teste)
    ctx.fillStyle = 'orange';
    ctx.fillRect(boss.x, boss.y, boss.w, boss.h); 
    
    // Rosto do Boss (estético)
    ctx.fillStyle = 'yellow';
    ctx.fillRect(boss.x + 40, boss.y + 40, 70, 70);

    // Desenha Balas
    ctx.fillStyle = 'cyan';
    bullets.forEach(b => ctx.fillRect(b.x, b.y, b.w, b.h));

    if (boss.hp > 0) {
        requestAnimationFrame(() => {
            update();
            draw();
        });
    } else {
        ctx.fillStyle = "white";
        ctx.font = "50px Arial";
        ctx.fillText("KNOCKOUT!", 250, 200);
    }
}

draw();
</script>
</body>
</html>
